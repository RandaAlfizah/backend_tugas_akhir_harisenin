'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var classes = require('@automapper/classes');
var core = require('@automapper/core');

function sequelize(options = core.defaultStrategyInitializerOptions) {
  const mergedOptions = {
    ...core.defaultStrategyInitializerOptions,
    destinationConstructor: (_, destinationIdentifier) => {
      if ('sequelize' in destinationIdentifier) {
        return destinationIdentifier.build();
      }
      return new destinationIdentifier();
    },
    ...options
  };
  if (mergedOptions.preMap === core.defaultStrategyInitializerOptions.preMap) {
    mergedOptions.preMap = source => {
      if (source.get) {
        return source.get();
      }
      return source;
    };
  }
  return classes.classes(mergedOptions);
}

exports.sequelize = sequelize;
